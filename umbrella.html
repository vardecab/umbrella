<!DOCTYPE html><html lang="pl"><head><title>Umbrella</title><meta property="og:title" content="Umbrella"><meta name="description" content="Prosta strona z informacjami pogodowymi, ktÃ³ra powie Ci, czy musisz wziÄ…Ä‡ parasol, wychodzÄ…c na zewnÄ…trz."><meta property="og:description" content="Prosta strona z informacjami pogodowymi, ktÃ³ra powie Ci, czy musisz wziÄ…Ä‡ parasol, wychodzÄ…c na zewnÄ…trz."><meta property="og:image" content="https://vardecab.github.io/umbrella/images/social-sharing/umbrella-facebook-ogimage-v2.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:url" content="https://vardecab.github.io/umbrella/umbrella.html"><meta name="twitter:card" content="summary_large_image"><meta name="theme-color" content="#000000"><!-- default --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" href="./images/umbrella-icon_blue-circle.png"><link rel="stylesheet" href="./styles/styles.min.css"><script src="./scripts/weather.min.js"></script><script src="./scripts/air_quality.min.js"></script><!-- <script src="./scripts/allergy.js"></script> NOTE: API doesn't have good coverage --><script src="./scripts/libraries/moment.min.js"></script><!-- time formats manipulation --><script src="./scripts/libraries/js.cookie.min.js"></script><!-- lightweight JavaScript API for handling browser cookies --></head><body><div class="container"><div class="row"><div class="twelve columns"><img id="icon" src="./images/status/loading.svg"><div id="temperature" title="Åšrednia odczuwalna temperatura w ciÄ…gu najbliÅ¼szych ~ 6 godzin."></div><div id="more_details"><span id="sunrise" title="WschÃ³d sÅ‚oÅ„ca:">â˜€ï¸</span> <span id="wind" title="PrÄ™dkoÅ›Ä‡ wiatru:">ğŸƒ</span> <span id="air_pressure" title="CiÅ›nienie:"></span> <span id="sunset" title="ZachÃ³d sÅ‚oÅ„ca:">ğŸŒ’</span></div><div id="loading">PatrzÄ™ w chmury... ğŸ§</div><div id="umbrella" title="Deszcz?"></div><div id="clothes" title="Co by tu ubraÄ‡? ğŸ¤”"></div><div id="air_quality" title="ğŸ¤“ Dobre; ğŸ¤¢ ZÅ‚e; ğŸ¤¬ Szkodliwe; âš°ï¸ RIP"></div></div></div></div><div id="bottom_navbar"><div id="to_the_right"><p id="findme" onclick="Cookies.remove(&#34;umbrella_coord_lat&#34;),Cookies.remove(&#34;umbrella_coord_lng&#34;),Cookies.remove(&#34;umbrella_location&#34;)" title="Find me!">ğŸ“</p><p id="location" onclick="Cookies.remove(&#34;umbrella_coord_lat&#34;),Cookies.remove(&#34;umbrella_coord_lng&#34;),Cookies.remove(&#34;umbrella_location&#34;)" title="Change the location.">ğŸŒ</p></div><div id="to_the_left"><p onclick="window.location=&#34;umbrella-en.html&#34;" title="Change language to English.">ğŸ‡¬ğŸ‡§</p></div></div><script>window.onload = function geoLocator() {
				if (
					Cookies.get("umbrella_coord_lat") == undefined ||
					Cookies.get("umbrella_coord_lng") == undefined
				) {
					// get coords from geolocation (GPS/IP)
					function success(position) {
						const geo_latitude = position.coords.latitude;
						const geo_longitude = position.coords.longitude;

						// set ğŸª for latitude
						Cookies.set("umbrella_coord_lat", geo_latitude, {
							expires: 30,
							path: "/"
						});
						// set ğŸª for longitude
						Cookies.set("umbrella_coord_lng", geo_longitude, {
							expires: 30,
							path: "/"
						});
						console.log(
							"Cookie data: " +
								"lat:" +
								Cookies.get("umbrella_coord_lat") +
								" lng:" +
								Cookies.get("umbrella_coord_lng")
						); // debug

						// variables with values from ğŸªs
						cookie_lng = Cookies.get("umbrella_coord_lng");
						cookie_lat = Cookies.get("umbrella_coord_lat");

						// API key which we use in the next piece
						const liq_api_key = "a95509ae99d0ab"; // well... no way to hide it Â¯\_(ãƒ„)_/Â¯

						// we need to get city name from LocationIQ API
						fetch(
							"https://eu1.locationiq.com/v1/reverse.php?key=" +
								liq_api_key +
								"&lat=" +
								cookie_lat +
								"&lon=" +
								cookie_lng +
								"&format=json"
						)
							// convert data to JSON
							.then(function(res) {
								return res.json();
							})

							// use the data stored in object to do whatever
							.then(function(liq_data) {
								console.error("LocationIQ", liq_data); // debug: output everything stored in the object

								// get city name
								// liq_location = data.address.city;
								// liq_location = data[0].display_name.split(",")[0];
								if (
									(liq_data.address.town = "null") ||
									(liq_data.address.town = "undefined") ||
									(liq_data.address.town = "")
								) {
									if (
										(liq_data.address.city = "null") ||
										(liq_data.address.city = "undefined") ||
										(liq_data.address.city = "")
									) {
										liq_location = liq_data.address.county;
									} else {
										liq_location = liq_data.address.city;
									}
								}

								// show city name on the website
								document.getElementById(
									"location"
								).textContent = "ğŸŒ " + liq_location;

								// set ğŸª for location name so we can reuse in future without querying API
								Cookies.set("umbrella_location", liq_location, {
									expires: 30,
									path: "/"
								});
							});

						weatherBallon(cookie_lat, cookie_lng); // pass coords to get weather info
						airMask(cookie_lat, cookie_lng); // pass coords to get air quality info
						// apsik(cookie_lat, cookie_lng); // pass coords to get allergy info; NOTE: API doesn't have good coverage
					}

					function error() {
						alert(
							"WyglÄ…da na to, Å¼e nie mogÄ™ znaleÅºÄ‡ Twojej lokalizacji... Prawdopodobnie masz wyÅ‚Ä…czony GPS :("
						);
						// if we don't know the location let's ask the user
						query_input = prompt(
							"Dla jakiego miejsca chcesz sprawdziÄ‡ pogodÄ™?"
						);
						console.log("User-requested city:", query_input); // debug

						const liq_api_key = "a95509ae99d0ab"; // well... no way to hide it Â¯\_(ãƒ„)_/Â¯

						// grab data from URL
						fetch(
							"https://eu1.locationiq.com/v1/search.php?key=" +
								liq_api_key +
								"&q=" +
								query_input +
								"&format=json"
						)
							// convert data to JSON
							.then(function(res) {
								return res.json();
							})

							// use the data stored in object to do whatever
							.then(function(liq_data) {
								console.error("LocationIQ", liq_data); // debug: output everything stored in the object

								// get location name based on what was returned from API and cut it to just city
								liq_location = liq_data[0].display_name.split(
									","
								)[0];
								// console.error(liq_location); // debug

								document.getElementById(
									"location"
								).textContent = "ğŸŒ " + liq_location;

								// set ğŸª for location name
								Cookies.set("umbrella_location", liq_location, {
									expires: 30,
									path: "/"
								});

								// get coords from API based on location user inputted
								lat = liq_data[0].lat;
								lng = liq_data[0].lon;
								console.log("Coords: " + lat + ", " + lng); // debug

								// set ğŸª for latitude
								Cookies.set("umbrella_coord_lat", lat, {
									expires: 30,
									path: "/"
								});
								// set ğŸª for longitude
								Cookies.set("umbrella_coord_lng", lng, {
									expires: 30,
									path: "/"
								});
								console.log(
									"Cookie: " +
										"lat:" +
										Cookies.get("umbrella_coord_lat") +
										" lng:" +
										Cookies.get("umbrella_coord_lng")
								); // debug

								// variables with values from ğŸªs
								cookie_lng = Cookies.get("umbrella_coord_lng");
								cookie_lat = Cookies.get("umbrella_coord_lat");
								// alert(liq_data.address.city); // debug
								// alert(liq_location); // debug

								weatherBallon(cookie_lat, cookie_lng); // pass coords to get weather info
								airMask(cookie_lat, cookie_lng); // pass coords to get air quality info
								// apsik(cookie_lat, cookie_lng); // pass coords to get allergy info; NOTE: API doesn't have good coverage
							});
					}
				}
				// cookies set so we'll use that
				else {
					console.error(
						"LocationIQ data not necessary - took data from ğŸªs."
					);

					console.log(
						"Cookie: " +
							"lat:" +
							Cookies.get("umbrella_coord_lat") +
							" lng:" +
							Cookies.get("umbrella_coord_lng")
					); // debug

					// variables with values from ğŸªs
					cookie_lng = Cookies.get("umbrella_coord_lng");
					cookie_lat = Cookies.get("umbrella_coord_lat");
					cookie_location = Cookies.get("umbrella_location");

					if (cookie_location == "undefined") {
						document.getElementById("location").textContent = "ğŸŒ ";
					} else {
						document.getElementById("location").textContent =
							"ğŸŒ " + cookie_location;
					}

					weatherBallon(cookie_lat, cookie_lng); // pass coords to get weather info
					airMask(cookie_lat, cookie_lng); // pass coords to get air quality info
					// apsik(cookie_lat, cookie_lng); // pass coords to get allergy info; NOTE: API doesn't have good coverage}
				}

				if (!navigator.geolocation) {
					alert(
						"Geolokalizacja nie jest wspierana przez TwojÄ… przeglÄ…darkÄ™... :("
					);
				} else {
					navigator.geolocation.getCurrentPosition(success, error);
				}
			};

			function manualFinder() {
				query_input = prompt(
					"Dla jakiego miejsca chcesz sprawdziÄ‡ pogodÄ™?"
				); // if we don't know the location let's ask the user
				console.log("City:", query_input); // debug

				const liq_api_key = "a95509ae99d0ab"; // well... no way to hide it Â¯\_(ãƒ„)_/Â¯

				// grab data from URL
				fetch(
					"https://eu1.locationiq.com/v1/search.php?key=" +
						liq_api_key +
						"&q=" +
						query_input +
						"&format=json"
				)
					// convert data to JSON
					.then(function(res) {
						return res.json();
					})

					// use the data stored in object to do whatever
					.then(function(liq_data) {
						console.error("LocationIQ", liq_data); // debug: output everything stored in the object

						// get location name based on what was returned from API and cut it to just city
						liq_location = liq_data[0].display_name.split(",")[0];
						// liq_location = liq_data.address.town;
						// console.error(liq_location); // debug

						document.getElementById("location").textContent =
							"ğŸŒ " + liq_location;

						// set ğŸª for location name
						Cookies.set("umbrella_location", liq_location, {
							expires: 30,
							path: "/"
						});

						// get coords from API based on location user inputted
						lat = liq_data[0].lat;
						lng = liq_data[0].lon;
						console.log("Coords: " + lat + ", " + lng); // debug

						// set ğŸª for latitude
						Cookies.set("umbrella_coord_lat", lat, {
							expires: 30,
							path: "/"
						});
						// set ğŸª for longitude
						Cookies.set("umbrella_coord_lng", lng, {
							expires: 30,
							path: "/"
						});
						console.log(
							"Cookie: " +
								"lat:" +
								Cookies.get("umbrella_coord_lat") +
								" lng:" +
								Cookies.get("umbrella_coord_lng")
						); // debug

						// variables with values from ğŸªs
						cookie_lng = Cookies.get("umbrella_coord_lng");
						cookie_lat = Cookies.get("umbrella_coord_lat");

						weatherBallon(cookie_lat, cookie_lng); // pass coords to get weather info
						airMask(cookie_lat, cookie_lng); // pass coords to get air quality info
						// apsik(cookie_lat, cookie_lng); // pass coords to get allergy info; NOTE: API doesn't have good coverage

						location.reload();
					});
			}

			// find using GPS/IP when clicked on ğŸ“
			function findMe() {
				function success(position) {
					const geo_latitude = position.coords.latitude;
					const geo_longitude = position.coords.longitude;

					// set ğŸª for latitude
					Cookies.set("umbrella_coord_lat", geo_latitude, {
						expires: 30,
						path: "/"
					});
					// set ğŸª for longitude
					Cookies.set("umbrella_coord_lng", geo_longitude, {
						expires: 30,
						path: "/"
					});
				}

				if (!navigator.geolocation) {
					alert(
						"Geolokalizacja nie jest wspierana przez TwojÄ… przeglÄ…darkÄ™... :("
					);
				} else {
					var locating = document.querySelector("#findme");
					locating.textContent = "OdÅ›wieÅ¼ stronÄ™ :)";
					location.reload();
					navigator.geolocation.getCurrentPosition(success, error);
				}
			}

			document
				.querySelector("#location")
				.addEventListener("click", manualFinder);
			document.querySelector("#findme").addEventListener("click", findMe);

			function smogAlert() {
				setTimeout(function() {
					var air_quality_status = document.getElementById(
						"air_quality"
					).textContent;
					if (
						air_quality_status == "Powietrze: âš°ï¸" ||
						air_quality_status == "Powietrze: âš°ï¸âš°ï¸" ||
						air_quality_status == "Powietrze: âš°ï¸âš°ï¸âš°ï¸"
					) {
						// alert("Lepiej nie wychodÅº z budynku i nie otwieraj okien! Smog zabija â˜ ï¸"); // replaced with notification
						// Let's check if the browser supports notifications
						if (!("Notification" in window)) {
							console.error(
								"This browser does not support desktop notifications."
							);
						}

						// Let's check whether notification permissions have already been granted
						else if (Notification.permission === "granted") {
							// If it's okay let's create a notification
							var notification = new Notification(
								"Smog zabija â˜ ï¸",
								{
									icon:
										"./images/umbrella-icon_blue-circle.png",
									body:
										"Nie wychodÅº z budynku i nie otwieraj okien!"
								}
							);
						}

						// Otherwise, we need to ask the user for permission
						else if (Notification.permission !== "denied") {
							Notification.requestPermission().then(function(
								permission
							) {
								// If the user accepts, let's create a notification
								if (permission === "granted") {
									var notification = new Notification(
										"Smog zabija â˜ ï¸",
										{
											icon:
												"./images/umbrella-icon_blue-circle.png",
											body:
												"Nie wychodÅº z budynku i nie otwieraj okien!"
										}
									);
								}
							});
						}
					} else console.log("No alert/notification, air is not so bad. Current: >", air_quality_status, "<");
				}, 1500); // how many ms to wait until function is executed; 1500 ms = 1.5 s
			}

			smogAlert();</script></body></html>